# **RWF Comprehensive Sensitivity Analysis & Break-Even Implementation Plan**

## **Overview**

**Objective:** Quantify uncertainty in LNPV through systematic sensitivity analysis and Monte Carlo simulation. Since RWF cost data is unavailable, perform **break-even analysis** calculating maximum allowable cost per beneficiary at BCR thresholds (1.0, 2.0, 3.0).

**Primary Formula:** `Max_Cost = LNPV / Target_BCR`

---

## **Current State**

### **Existing Infrastructure**

| File | Purpose | Status |
| ----- | ----- | ----- |
| `model/parameter_registry_v3.py` | 78 parameters with sampling specs, SCENARIO\_CONFIGS | Ready |
| `model/economic_core_v4.py` | LNPV calculation, MonteCarloSimulator | Ready |
| `model/sensitivity_analysis_v2.py` | OAT tornado, break-even analysis | Ready |
| `model/sensitivity_scenarios_rte.py` | Decomposition (Placement 79% \+ Mincer 21%) | Ready |

### **Existing Outputs (`model/outputs/`)**

* `lnpv_results_v4.csv` \- 32 scenarios with baseline LNPV  
* `sensitivity_tornado_rte.csv` \- OAT rankings for RTE  
* `sensitivity_tornado_apprenticeship.csv` \- OAT rankings for Apprenticeship  
* `sensitivity_breakeven.csv` \- Break-even thresholds

### **Key Baseline Values (from lnpv\_results\_v4.csv)**

* **RTE LNPV Range:** Rs 3.85L (East Female Rural) to Rs 18.01L (South Male Urban)  
* **Apprenticeship LNPV Range:** Rs 19.64L (East Female Rural) to Rs 55.21L (South Male Urban)  
* P(Formal) varies by region: East 12%, North 15%, West 20%, South 25%

---

## **Architecture Decision**

**Create new file: `model/sensitivity_analysis_comprehensive.py`**

Rationale:

* Keep existing `sensitivity_analysis_v2.py` focused (OAT utilities)  
* New script orchestrates all 9 tasks with unified CLI  
* Imports utilities from existing modules  
* Generates all deliverables to organized output structure

---

## **Output Structure**

model/outputs/sensitivity/  
├── one\_way/  
│   ├── sensitivity\_p\_formal\_rte.csv  
│   ├── sensitivity\_halflife.csv  
│   ├── sensitivity\_p\_formal\_apprentice.csv  
│   └── sensitivity\_test\_score.csv  
├── two\_way/  
│   ├── heatmap\_rte\_pformal\_testscore.csv  
│   ├── heatmap\_app\_pformal\_halflife.csv  
│   └── heatmap\_mincer\_discount.csv  
├── monte\_carlo/  
│   ├── monte\_carlo\_distributions.csv (summary)  
│   └── monte\_carlo\_full\_results.csv (32,000 rows)  
├── scenarios/  
│   └── scenario\_bounds.csv  
├── breakeven/  
│   ├── breakeven\_analysis\_32scenarios.csv  
│   └── breakeven\_comparison\_by\_region.csv  
├── decomposition/  
│   └── decomposition\_analysis.csv  
└── visualizations/  
    ├── tornado\_rte.png  
    ├── tornado\_apprenticeship.png  
    ├── lineplot\_halflife.png  
    ├── heatmap\_\*.png (3 files)  
    ├── histogram\_monte\_carlo\_\*.png (2 files)  
    ├── boxplot\_regional.png  
    ├── breakeven\_bar\_chart.png

    └── decomposition\_stacked\_bar.png

---

## **Implementation Tasks**

### **Task 1: One-Way Sensitivity \- P\_FORMAL\_RTE**

**Purpose:** Sweep formal sector entry rate for RTE graduates (primary NPV driver)

**Values:** \[20%, 25%, 30%, 35%, 40%, 50%\]

**Implementation:**

python  
def one\_way\_p\_formal\_rte():  
    results \= \[\]  
    for p\_formal in \[0.20, 0.25, 0.30, 0.35, 0.40, 0.50\]:  
        *\# Create modified registry*  
        params \= ParameterRegistry()  
        params.P\_FORMAL\_RTE \= p\_formal  
        calculator \= LifetimeNPVCalculator(params\=params)

        for region, gender, location in all\_16\_rte\_scenarios:  
            result \= calculator.calculate\_lnpv(  
                Intervention.RTE, gender, location, region  
            )  
            lnpv \= result\['lnpv'\]  
            results.append({  
                'p\_formal\_rte': p\_formal,  
                'region': region, 'gender': gender, 'location': location,  
                'lnpv': lnpv,  
                'max\_cost\_bcr\_1': lnpv / 1.0,  
                'max\_cost\_bcr\_2': lnpv / 2.0,  
                'max\_cost\_bcr\_3': lnpv / 3.0,  
            })

    return pd.DataFrame(results)

**Output:** `sensitivity_p_formal_rte.csv` (96 rows: 6 values × 16 scenarios)

---

### **Task 2: One-Way Sensitivity \- Half-Life (h)**

**Purpose:** Apprenticeship wage premium decay rate

**Values:** \[5, 10, 15, 20, 30, 50\] years

**Implementation:** Modify `APPRENTICE_DECAY_HALFLIFE` parameter, run 16 Apprenticeship scenarios for each value.

**Output:** `sensitivity_halflife.csv` (96 rows: 6 values × 16 scenarios)

---

### **Task 3: One-Way Sensitivity \- P\_FORMAL\_APPRENTICE**

**Purpose:** Formal sector placement rate for apprentices

**Values:** \[50%, 60%, 72%, 80%, 90%\]

**Output:** `sensitivity_p_formal_apprentice.csv` (80 rows: 5 values × 16 scenarios)

---

### **Task 4: One-Way Sensitivity \- Test Score Effect**

**Purpose:** RTE test score gain (ITT estimate)

**Values:** \[0.10, 0.137, 0.15, 0.18, 0.20\] SD

**Output:** `sensitivity_test_score.csv` (80 rows: 5 values × 16 scenarios)

---

### **Task 5: Two-Way Sensitivity Heatmaps**

**Three Heatmaps:**

1. **P\_FORMAL\_RTE × P\_FORMAL\_HIGHER\_SECONDARY** (RTE)  
   * Rows: P\_FORMAL\_RTE \= \[20%, 30%, 40%, 50%\]  
   * Cols: P\_FORMAL\_HIGHER\_SECONDARY \= \[5%, 9.1%, 12%, 15%\]  
   * Representative scenario: Male, Urban, West  
2. **P\_FORMAL\_APPRENTICE × HALFLIFE** (Apprenticeship)  
   * Rows: HALFLIFE \= \[5, 10, 20, 30, 50\]  
   * Cols: P\_FORMAL\_APPRENTICE \= \[50%, 60%, 72%, 80%, 90%\]  
3. **MINCER\_RETURN\_HS × SOCIAL\_DISCOUNT\_RATE** (Both)  
   * Rows: MINCER \= \[5%, 6%, 7%, 8%, 9%\]  
   * Cols: DISCOUNT \= \[3%, 4%, 5%, 6.5%, 8%\]

**Implementation:** Nested loops modifying two parameters, calculate LNPV for reference scenario.

**Output:** 3 CSV files \+ 3 PNG heatmaps

---

### **Task 6: Monte Carlo Uncertainty Quantification**

**Configuration:**

* N \= 1000 simulations  
* 32 scenarios (all demographics)  
* Use `sample_parameter()` from parameter\_registry\_v3.py

**Parameters to Sample:**

| Parameter | Distribution | Params |
| ----- | ----- | ----- |
| P\_FORMAL\_RTE | beta | scaled to \[0.20, 0.50\] |
| P\_FORMAL\_APPRENTICE | beta | scaled to \[0.50, 0.90\] |
| APPRENTICE\_DECAY\_HALFLIFE | triangular | (5, 10, 50\) |
| MINCER\_RETURN\_HS | triangular | (0.05, 0.07, 0.09) |
| RTE\_TEST\_SCORE\_GAIN | triangular | (0.10, 0.137, 0.20) |
| SOCIAL\_DISCOUNT\_RATE | uniform | (0.03, 0.08) |
| REAL\_WAGE\_GROWTH\_FORMAL | triangular | (0.005, 0.015, 0.025) |
| REAL\_WAGE\_GROWTH\_INFORMAL | triangular | (-0.01, \-0.002, 0.005) |

**Wage Growth Co-variation:** Vary FORMAL and INFORMAL together maintaining \~1.7pp gap.

**Output Statistics:**

* Median, 5th/95th percentile LNPV  
* P(LNPV \> 0\)  
* Break-even costs at each percentile

**Output:** `monte_carlo_distributions.csv`, `monte_carlo_full_results.csv`

---

### **Task 7: Scenario Analysis \- Bias Bounds**

**Use existing SCENARIO\_CONFIGS:**

| Scenario | P\_FORMAL\_RTE | P\_FORMAL\_APP | TEST\_SCORE | HALFLIFE | DISCOUNT |
| ----- | ----- | ----- | ----- | ----- | ----- |
| Conservative | 20% | 50% | 0.10 SD | 5 yr | 8% |
| Moderate | 30% | 72% | 0.137 SD | 10 yr | 5% |
| Optimistic | 50% | 90% | 0.20 SD | 50 yr | 3% |

**Output:** `scenario_bounds.csv` with LNPV and Max\_Cost at BCR=1,2,3 for each scenario

---

### **Task 8: Break-Even Analysis (All 32 Scenarios)**

**Primary deliverable \- Calculate for each scenario:**

* LNPV  
* Max\_Cost at BCR=1 (break-even)  
* Max\_Cost at BCR=2 (moderately cost-effective)  
* Max\_Cost at BCR=3 (highly cost-effective \- RWF threshold)  
* Cost tolerance at BCR=3  
* Ranking by robustness

**Regional Summary:** Average Max\_Cost by region at BCR=3

**Output:** `breakeven_analysis_32scenarios.csv`, `breakeven_comparison_by_region.csv`

---

### **Task 9: Decomposition Analysis**

**Use `sensitivity_scenarios_rte.py` logic:**

Scenario A: Control (P\_FORMAL \= 9.1%, no Mincer)  
Scenario B: Placement only (P\_FORMAL\_RTE \= 30%, no Mincer)  
Scenario C: Full treatment (P\_FORMAL\_RTE \= 30% \+ Mincer)

Placement Effect \= NPV(B) \- NPV(A)  \~79%

Mincer Effect \= NPV(C) \- NPV(B)     \~21%

**Run for:** All 16 RTE demographic combinations

**Additional Analysis:** At what P\_FORMAL\_RTE does Mincer Effect \> Placement Effect?

**Output:** `decomposition_analysis.csv`

---

## **Visualizations (7+ Figures)**

1. **Tornado Diagrams** (2): RTE and Apprenticeship, ranked by elasticity  
2. **Line Plot**: LNPV vs Half-life with BCR threshold lines  
3. **Heatmaps** (3): Two-way sensitivity surfaces with color gradients  
4. **Histograms** (2): Monte Carlo LNPV distributions by intervention  
5. **Box Plot**: Regional comparison with uncertainty bands  
6. **Break-Even Bar Chart**: 32 scenarios with BCR=1,2,3 bars  
7. **Decomposition Stacked Bar**: Placement vs Mincer contribution by P\_FORMAL\_RTE

**Specifications:** 300 DPI, consistent color scheme, matplotlib

---

## **Critical Files to Modify/Create**

### **New File: `model/sensitivity_analysis_comprehensive.py`**

python  
"""  
RWF Comprehensive Sensitivity Analysis  
\======================================  
Unified analysis pipeline for Tasks 1-9.

Usage:  
    python \-m model.sensitivity\_analysis\_comprehensive \--all  
    python \-m model.sensitivity\_analysis\_comprehensive \--task monte\_carlo  
"""

class ComprehensiveSensitivityAnalysis:  
    def \_\_init\_\_(self, output\_dir, n\_mc\_simulations\=1000, seed\=42):  
        ...

    *\# Task 1-4: One-way sensitivity*  
    def one\_way\_p\_formal\_rte(self) \-\> pd.DataFrame  
    def one\_way\_halflife(self) \-\> pd.DataFrame  
    def one\_way\_p\_formal\_apprentice(self) \-\> pd.DataFrame  
    def one\_way\_test\_score(self) \-\> pd.DataFrame

    *\# Task 5: Two-way heatmaps*  
    def two\_way\_heatmap(self, param1, param2, intervention) \-\> pd.DataFrame

    *\# Task 6: Monte Carlo*  
    def monte\_carlo\_comprehensive(self) \-\> Tuple\[pd.DataFrame, pd.DataFrame\]

    *\# Task 7: Scenario bounds*  
    def scenario\_bounds(self) \-\> pd.DataFrame

    *\# Task 8: Break-even all scenarios*  
    def breakeven\_all\_scenarios(self) \-\> pd.DataFrame

    *\# Task 9: Decomposition*  
    def decomposition\_all\_scenarios(self) \-\> pd.DataFrame

    *\# Visualization*  
    def generate\_all\_visualizations(self)

    *\# Narrative*  
    def generate\_narrative(self) \-\> str

class SensitivityVisualizer:  
    """Matplotlib visualization utilities"""  
    def tornado\_diagram(self, df, intervention, save\_path)  
    def line\_plot(self, df, param\_name, save\_path)  
    def heatmap(self, df, title, save\_path)  
    def histogram(self, samples, scenario\_id, save\_path)  
    def boxplot\_regional(self, mc\_results, save\_path)  
    def breakeven\_bar\_chart(self, breakeven\_df, save\_path)

    def decomposition\_stacked\_bar(self, decomp\_df, save\_path)

---

## **Execution Sequence**

Phase 1: One-Way Sensitivity (Tasks 1-4)  
├── Run 4 parameter sweeps  
├── Generate tornado diagrams  
└── Generate line plots

Phase 2: Two-Way Sensitivity (Task 5\)  
├── Generate 3 heatmap grids  
└── Create heatmap visualizations

Phase 3: Monte Carlo (Task 6\)  
├── Sample parameters using registry distributions  
├── Run 1000 × 32 \= 32,000 LNPV calculations  
├── Generate summary statistics  
└── Create histograms and boxplots

Phase 4: Scenario Bounds (Task 7\)  
├── Apply SCENARIO\_CONFIGS overrides  
└── Calculate conservative/moderate/optimistic bounds

Phase 5: Break-Even (Task 8\)  
├── Calculate Max\_Cost at BCR=1,2,3 for all 32 scenarios  
├── Regional aggregation  
└── Create bar chart

Phase 6: Decomposition (Task 9\)  
├── Run 3-scenario decomposition for 16 RTE demographics  
└── Create stacked bar chart

Phase 7: Narrative Report

└── Generate sensitivity\_analysis\_narrative.md

---

## **Verification Approach**

### **Sanity Checks**

1. **Monotonicity:** LNPV should increase with P\_FORMAL (both interventions)  
2. **Decomposition sum:** Placement \+ Mincer \= Total (within 0.01% tolerance)  
3. **MC bounds:** 5th/95th percentiles should bracket scenario bounds  
4. **Break-even positivity:** All LNPV \> 0 → all Max\_Cost \> 0

### **Cross-Validation**

* Compare new tornado rankings with existing `sensitivity_tornado_*.csv`  
* Verify MC distributions align with parameter ranges

### **Execution Test**

bash  
*\# Run full pipeline*  
python \-m model.sensitivity\_analysis\_comprehensive \--all

*\# Verify outputs exist*

ls \-la model/outputs/sensitivity/

---

## **CLI Interface**

bash  
*\# Full analysis (recommended)*  
python \-m model.sensitivity\_analysis\_comprehensive \--all

*\# Individual tasks*  
python \-m model.sensitivity\_analysis\_comprehensive \--task one\_way  
python \-m model.sensitivity\_analysis\_comprehensive \--task two\_way  
python \-m model.sensitivity\_analysis\_comprehensive \--task monte\_carlo \--n-simulations 1000  
python \-m model.sensitivity\_analysis\_comprehensive \--task scenarios  
python \-m model.sensitivity\_analysis\_comprehensive \--task breakeven  
python \-m model.sensitivity\_analysis\_comprehensive \--task decomposition

*\# Generate narrative only*

python \-m model.sensitivity\_analysis\_comprehensive \--narrative-only

---

## **Expected Output Summary**

| Deliverable | Rows/Items | Description |
| ----- | ----- | ----- |
| `sensitivity_p_formal_rte.csv` | 96 | 6 values × 16 RTE scenarios |
| `sensitivity_halflife.csv` | 96 | 6 values × 16 App scenarios |
| `sensitivity_p_formal_apprentice.csv` | 80 | 5 values × 16 App scenarios |
| `sensitivity_test_score.csv` | 80 | 5 values × 16 RTE scenarios |
| `heatmap_*.csv` | 3 files | 2D grids for parameter pairs |
| `monte_carlo_distributions.csv` | 32 | Summary per scenario |
| `monte_carlo_full_results.csv` | 32,000 | All MC draws |
| `scenario_bounds.csv` | 96 | 3 scenarios × 32 demographics |
| `breakeven_analysis_32scenarios.csv` | 32 | Primary break-even table |
| `breakeven_comparison_by_region.csv` | 8 | Regional averages |
| `decomposition_analysis.csv` | 16 | RTE scenarios only |
| Visualizations | 12+ | PNG figures at 300 DPI |
| `sensitivity_analysis_narrative.md` | 1 | Interpretation document |

---

## **Key Decision Rules for RWF**

**Break-Even Interpretation:**

"If per-beneficiary cost \< Max\_Cost(BCR=3), intervention is highly cost-effective."

**Example:** If RTE Male Urban West has Max\_Cost(BCR=3) \= Rs 4.79 lakhs, then:

* Cost \< Rs 4.79L → BCR \> 3 (highly cost-effective)  
* Cost \< Rs 7.19L → BCR \> 2 (moderately cost-effective)  
* Cost \< Rs 14.37L → BCR \> 1 (cost-effective)

